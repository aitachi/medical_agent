---
name: response-formatter
description: 响应格式化Skill，负责格式化所有医疗响应，确保包含必要的安全提示和免责声明。不调用MCP工具，对其他Skill的输出进行后处理。
disable-model-invocation: false
---

# 响应格式化 Skill

对所有医疗响应进行格式化，确保一致性和安全性。

## 格式化规则

### 1. 必需元素

每个医疗响应必须包含：

#### 免责声明
```markdown
> ⚠️ **免责声明**: 以上信息仅供参考，不能替代专业医疗诊断和治疗。如有不适请及时就医。
```

#### 紧急情况提示（如适用）
```markdown
> 🚨 **紧急情况**: 如有以下情况请立即就医或拨打120：
> - 剧烈疼痛或突发严重症状
> - 呼吸困难、意识模糊
> - 持续高烧不退
> - 严重外伤或大出血
```

### 2. 响应结构

```markdown
## 📋 标题

### 主要内容
{主要内容}

### 补充信息
{补充信息}

### 注意事项
{注意事项}

---

[免责声明]
```

### 3. Markdown格式规范

| 元素 | 格式 | 示例 |
|------|------|------|
| 标题 | ## 标题 | ## 关于头痛 |
| 强调 | **粗体** | **严重程度** |
| 列表 | - 或 1. | - 症状1<br>- 症状2 |
| 警告 | > | > ⚠️ 注意 |
| 代码 | `代码` | `体温>39℃` |
| 表格 | \| \| \| | \| 科室 \| 位置 \| |
| 分隔线 | --- | --- |

### 4. 表情符号使用

| 场景 | 表情 | 用途 |
|------|------|------|
| ⚠️ | 警告 | 注意事项、禁忌 |
| 🚨 | 紧急 | 紧急情况 |
| 💊 | 药品 | 药物相关 |
| 🏥 | 医院 | 科室、医院 |
| 📋 | 列表 | 信息列表 |
| 💡 | 提示 | 建议、提示 |
| ✅ | 正确 | 推荐、正确做法 |
| ❌ | 错误 | 禁忌、错误做法 |
| 📊 | 数据 | 检查指标 |
| 🩺 | 医疗 | 医疗相关 |
| 📍 | 位置 | 科室位置 |

### 5. 长度控制

| 响应类型 | 建议长度 |
|---------|---------|
| 简单问答 | < 200字 |
| 症状咨询 | 200-500字 |
| 药品咨询 | 300-600字 |
| 科室推荐 | 150-300字 |
| 健康教育 | 300-800字 |

### 6. 语气风格

- **专业**: 使用准确医学术语，附通俗解释
- **关切**: 表达对用户健康的关心
- **客观**: 不夸大、不恐吓
- **积极**: 提供建设性建议

## 格式化处理流程

```python
def format_response(response_data: dict) -> str:
    """
    格式化响应

    Args:
        response_data: {
            "type": "symptom|drug|department|health",
            "content": {...},
            "has_risk": bool,
            "urgent": bool
        }
    """
    # 1. 添加标题
    response = add_header(response_data)

    # 2. 格式化主体内容
    response += format_content(response_data["content"])

    # 3. 添加风险提示
    if response_data.get("has_risk"):
        response += add_warning()

    # 4. 添加紧急提示
    if response_data.get("urgent"):
        response += add_urgent_warning()

    # 5. 添加免责声明
    response += add_disclaimer()

    # 6. 添加后续建议
    response += add_follow_up()

    return response
```

## 各类型响应模板

### 症状咨询响应

```markdown
## 关于【{症状名称}】

### 症状描述
{症状描述}

### 常见原因
{原因列表}

### ⚠️ 危险信号
{红旗征列表}

### 建议科室
{推荐科室}

### 自我护理
{护理建议}

---

💡 **小贴士**: {额外提示}

---

{免责声明}
```

### 用药咨询响应

```markdown
## 💊 {药品名称}

### 基本信息
- **通用名**: {generic_name}
- **分类**: {category}

### 用法用量
- **成人**: {成人剂量}
- **儿童**: {儿童剂量}

### ⚠️ 注意事项
{注意事项}

### 可能副作用
{副作用列表}

### ❌ 禁忌情况
{禁忌列表}

---

{免责声明}

> 💊 **用药提醒**: 请严格遵医嘱用药，不要自行增减剂量
```

### 科室推荐响应

```markdown
## 🏥 科室推荐

根据您描述的「{症状}」，建议：

### 推荐科室
| 科室 | 适用情况 |
|------|---------|
| {科室1} | {描述} |
| {科室2} | {描述} |

### 就诊建议
{就诊建议}

### 科室位置
{位置信息}

---

📞 **咨询电话**: {医院电话}

{免责声明}
```

### 健康教育响应

```markdown
## {主题}

### 预防措施
{预防措施}

### 生活方式建议
{生活方式建议}

### ❌ 需要避免
{禁忌事项}

### ✅ 推荐做法
{推荐做法}

### 📅 定期检查
{检查建议}

---

{免责声明}
```

## 特殊场景处理

### 红旗征症状

当检测到红旗征时：

```markdown
> 🚨 **紧急提醒**: 您描述的症状中包含危险信号，建议您：
> 1. 立即前往医院就诊
> 2. 拨打120急救电话
> 3. 不要自行驾车（如症状严重）
```

### 儿童患者

```markdown
> 👶 **儿童健康提醒**:
> - 儿童用药需特别谨慎
> - 建议优先选择儿科专科就诊
> - 不要使用成人药物减量给儿童
```

### 孕妇/哺乳期

```markdown
> 🤰 **孕期/哺乳期提醒**:
> - 用药前请咨询产科医生
> - 很多药物可能影响胎儿/婴儿
> - 不要自行用药
```

### 老年患者

```markdown
> 👴 **老年人健康提醒**:
> - 老年人药物代谢较慢
> - 注意药物相互作用
> - 建议定期复查
```

## 后续建议

根据对话内容添加：

```markdown
---

**还有什么可以帮您的吗？**
- 了解更多关于{当前话题}的信息
- 咨询其他健康问题
- 预约挂号服务
```

或者：

```markdown
---

💡 **建议您**:
1. {建议1}
2. {建议2}

如需进一步帮助，请随时询问。
```

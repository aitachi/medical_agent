# åŒ»ç–—æ™ºèƒ½åŠ©æ‰‹ - Skill å®ç°æ€»ç»“

## ä¿®æ­£å®Œæˆ

ä¸‰ä¸ªä¸è°ƒç”¨MCPå·¥å…·çš„Skillå·²å…¨é¢ä¿®æ­£å¹¶é€šè¿‡æµ‹è¯•ã€‚

## Skill åŠŸèƒ½å¯¹æ¯”

| Skill | è°ƒç”¨MCP | å®ç°æ–¹å¼ | åŠŸèƒ½è¯´æ˜ | æµ‹è¯•çŠ¶æ€ |
|-------|---------|---------|---------|---------|
| **intent-classifier** | âŒ | å†…ç½®è§„åˆ™å¼•æ“ | æ„å›¾åˆ†ç±»ã€å®ä½“æŠ½å–ã€ç½®ä¿¡åº¦è®¡ç®— | âœ… PASS |
| **health-educator** | âŒ | å†…ç½®çŸ¥è¯†åº“ | ç–¾ç—…é¢„é˜²ã€é¥®é£Ÿç¦å¿Œã€è¿åŠ¨å»ºè®® | âœ… PASS |
| **response-formatter** | âŒ | æ ¼å¼åŒ–å¤„ç†å™¨ | ç»Ÿä¸€å“åº”æ ¼å¼ã€å…è´£å£°æ˜ã€ç´§æ€¥è­¦å‘Š | âœ… PASS |

---

## 1. Intent Classifier (æ„å›¾åˆ†ç±»)

### å®ç°ä½ç½®
`agent/medical_agent.py` - `IntentClassifier` ç±»

### æ ¸å¿ƒåŠŸèƒ½
- **8ç§æ„å›¾ç±»å‹**: ç—‡çŠ¶å’¨è¯¢ã€ç§‘å®¤æŸ¥è¯¢ã€ç”¨è¯å’¨è¯¢ã€é¢„çº¦æŒ‚å·ã€æŠ¥å‘Šè§£è¯»ã€å¥åº·æ•™è‚²ã€é—®å€™ã€æœªçŸ¥
- **è§„åˆ™å¼•æ“**: åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼åŒ¹é…
- **å…³é”®è¯åº“**: ç—‡çŠ¶ã€è¯å“ã€ç§‘å®¤ã€å¥åº·å…³é”®è¯
- **ä¸Šä¸‹æ–‡å…³è”**: æ”¯æŒå¤šè½®å¯¹è¯çš„æ„å›¾å»¶ç»­
- **å®ä½“æŠ½å–**: è‡ªåŠ¨æå–ç—‡çŠ¶ã€è¯å“ã€ç§‘å®¤ã€æ—¶é—´ã€ä¸¥é‡ç¨‹åº¦ç­‰å®ä½“

### æ„å›¾åŒ¹é…è§„åˆ™
```python
IntentType.SYMPTOM_INQUIRY:
    - (æˆ‘|æœ€è¿‘)(.+?)(ç–¼|ç—›|éš¾å—|ä¸èˆ’æœ)
    - (.+?)æ€ä¹ˆå›äº‹
    - å…³é”®è¯: å¤´ç—›ã€å‘çƒ­ã€å’³å—½...

IntentType.DEPARTMENT_QUERY:
    - (.+?)æŒ‚ä»€ä¹ˆç§‘
    - (.+?)å»å“ªä¸ªç§‘
    - å…³é”®è¯: ç§‘ã€æŒ‚å·ã€é¢„çº¦

IntentType.MEDICATION_CONSULT:
    - (.+?è¯)(æ€ä¹ˆåƒ|æ€ä¹ˆç”¨)
    - (.+?)æœ‰ä»€ä¹ˆå‰¯ä½œç”¨
    - å…³é”®è¯: é˜¿è«è¥¿æ—ã€å¸ƒæ´›èŠ¬...

IntentType.HEALTH_EDUCATION:
    - æ€ä¹ˆé¢„é˜²(.+?)
    - (.+?)ä¸èƒ½åƒä»€ä¹ˆ
    - å…³é”®è¯: é¢„é˜²ã€ç¦å¿Œã€æ³¨æ„äº‹é¡¹
```

### æµ‹è¯•ç»“æœ
```
å‡†ç¡®ç‡: 100.0% (8/8)
- æ€ä¹ˆé¢„é˜²é«˜è¡€å‹ -> health_education (1.10)
- ç³–å°¿ç—…ä¸èƒ½åƒä»€ä¹ˆ -> health_education (0.70)
- æœ‰ä»€ä¹ˆè¿åŠ¨å»ºè®® -> health_education (0.30)
- ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ -> health_education (0.30)
```

---

## 2. Health Educator (å¥åº·æ•™è‚²)

### å®ç°ä½ç½®
`agent/medical_agent.py` - `HealthKnowledgeBase` + `_health_educator_skill`

### æ ¸å¿ƒåŠŸèƒ½

#### ç–¾ç—…é¢„é˜²çŸ¥è¯†åº“
```python
DISEASE_PREVENTION = {
    "é«˜è¡€å‹": {
        "risk_factors": ["é«˜ç›é¥®é£Ÿ", "è‚¥èƒ–", "ç¼ºä¹è¿åŠ¨"],
        "prevention": {
            "diet": ["ä½ç›é¥®é£Ÿ", "ä½è„‚é¥®é£Ÿ", "å¤šåƒè”¬èœæ°´æœ"],
            "exercise": ["æ¯å‘¨3-5æ¬¡è¿åŠ¨", "æ¯æ¬¡30åˆ†é’Ÿä»¥ä¸Š"],
            "lifestyle": ["æ§åˆ¶ä½“é‡", "æˆ’çƒŸé™é…’", "ç®¡ç†å‹åŠ›"]
        },
        "symptoms": ["å¤´ç—›å¤´æ™•", "å¿ƒæ‚¸", "è§†åŠ›æ¨¡ç³Š"],
        "complications": ["å¿ƒè„ç—…", "è„‘å’ä¸­", "è‚¾è¡°ç«­"]
    },
    "ç³–å°¿ç—…": {...},
    "å¿ƒè¡€ç®¡ç–¾ç—…": {...}
}
```

#### é¥®é£Ÿç¦å¿ŒçŸ¥è¯†åº“
```python
FOOD_RESTRICTIONS = {
    "é«˜è¡€å‹": ["è…Œåˆ¶å“", "æ–¹ä¾¿é¢", "åŠ¨ç‰©å†…è„", "æ²¹ç‚¸é£Ÿå“"],
    "ç³–å°¿ç—…": ["ç³–æœ", "è›‹ç³•", "ç”œé¥®æ–™", "ç™½ç±³é¥­/é¢"],
    "ç—›é£": ["æµ·é²œ", "åŠ¨ç‰©å†…è„", "å•¤é…’", "æµ“æ±¤"],
    "èƒƒç—…": ["è¾›è¾£é£Ÿç‰©", "ç”Ÿå†·é£Ÿç‰©", "å’–å•¡", "é…’ç²¾"]
}
```

#### å“åº”æ ¼å¼åŒ–èƒ½åŠ›
- ç–¾ç—…é¢„é˜²æŒ‡å—ï¼ˆé£é™©å› ç´ ã€é¢„é˜²æªæ–½ã€ç—‡çŠ¶è¯†åˆ«ã€å¹¶å‘ç—‡ï¼‰
- é¥®é£Ÿç¦å¿Œï¼ˆéœ€è¦é¿å…çš„é£Ÿç‰©ã€é¥®é£Ÿå»ºè®®ï¼‰
- è¿åŠ¨æŒ‡å—ï¼ˆè¿åŠ¨åŸåˆ™ã€è¿åŠ¨ç±»å‹ã€æ³¨æ„äº‹é¡¹ï¼‰
- ç”Ÿæ´»æ–¹å¼å»ºè®®ï¼ˆé¥®é£Ÿã€ç¡çœ ã€è¿åŠ¨ã€å¿ƒç†ï¼‰

### æµ‹è¯•ç»“æœ
```
[æµ‹è¯•] ç–¾ç—…é¢„é˜²çŸ¥è¯†
  é«˜è¡€å‹é¢„é˜²: 3 ç±»å»ºè®® (diet, exercise, lifestyle)

[æµ‹è¯•] é¥®é£Ÿç¦å¿Œ
  é«˜è¡€å‹ç¦å¿Œ: 5 ç§é£Ÿç‰©

[æµ‹è¯•] å®Œæ•´Skillè°ƒç”¨
  "æ€ä¹ˆé¢„é˜²é«˜è¡€å‹": 425å­—, åŒ…å«å…è´£å£°æ˜
  "é«˜è¡€å‹ä¸èƒ½åƒä»€ä¹ˆ": 230å­—, åŒ…å«å…è´£å£°æ˜
  "æœ‰ä»€ä¹ˆè¿åŠ¨å»ºè®®": 384å­—, åŒ…å«å…è´£å£°æ˜
```

---

## 3. Response Formatter (å“åº”æ ¼å¼åŒ–)

### å®ç°ä½ç½®
`agent/medical_agent.py` - `ResponseFormatter` ç±»

### æ ¸å¿ƒåŠŸèƒ½

#### ç»Ÿä¸€æ ¼å¼åŒ–æ–¹æ³•
```python
ResponseFormatter.format(content, response_type, has_risk, urgent, **kwargs)
```

#### æ”¯æŒçš„å“åº”ç±»å‹
| ç±»å‹ | æ ¼å¼åŒ–å†…å®¹ | å…è´£å£°æ˜ |
|------|-----------|---------|
| `symptom` | ç—‡çŠ¶æè¿°ã€å¸¸è§åŸå› ã€çº¢æ——å¾ã€å»ºè®®ç§‘å®¤ã€è‡ªæˆ‘æŠ¤ç† | âœ… |
| `drug` | è¯å“ä¿¡æ¯ã€ç”¨æ³•ç”¨é‡ã€å‰¯ä½œç”¨ã€ç¦å¿Œç—‡ã€æ³¨æ„äº‹é¡¹ | âœ… |
| `department` | ç§‘å®¤æ¨èã€é€‚ç”¨èŒƒå›´ | âœ… |
| `health` | å¥åº·å»ºè®® | âœ… |
| `greeting` | é—®å€™å“åº” | âŒ |
| `fallback` | å…œåº•å“åº” | âŒ |

#### ç‰¹æ®ŠåŠŸèƒ½
```python
# å…è´£å£°æ˜
DISCLAIMER = "> âš ï¸ **å…è´£å£°æ˜**: ..."

# ç´§æ€¥è­¦å‘Š
URGENT_WARNING = "ğŸš¨ **ç´§æ€¥æƒ…å†µ**: å¦‚æœ‰ä»¥ä¸‹æƒ…å†µè¯·ç«‹å³å°±åŒ»..."

# æ·»åŠ æ–¹æ³•
add_disclaimer(response)      # æ·»åŠ å…è´£å£°æ˜
add_emergency_warning(response) # æ·»åŠ ç´§æ€¥è­¦å‘Š
format_with_emoji(text)        # æ·»åŠ è¡¨æƒ…ç¬¦å·
```

### æµ‹è¯•ç»“æœ
```
[æµ‹è¯•1] ç—‡çŠ¶å“åº”æ ¼å¼åŒ–
  æ ¼å¼åŒ–åé•¿åº¦: 216 å­—ç¬¦
  åŒ…å«å…è´£å£°æ˜: True
  åŒ…å«å±é™©ä¿¡å·: True
  åŒ…å«å»ºè®®ç§‘å®¤: True

[æµ‹è¯•2] è¯å“å“åº”æ ¼å¼åŒ–
  æ ¼å¼åŒ–åé•¿åº¦: 238 å­—ç¬¦
  åŒ…å«å…è´£å£°æ˜: True
  åŒ…å«ç”¨æ³•ç”¨é‡: True
  åŒ…å«å‰¯ä½œç”¨: True

[æµ‹è¯•3] å¥åº·æ•™è‚²å“åº”æ ¼å¼åŒ–
  æ ¼å¼åŒ–åé•¿åº¦: 63 å­—ç¬¦
  åŒ…å«å…è´£å£°æ˜: True

[æµ‹è¯•4] é—®å€™å“åº”æ ¼å¼åŒ–
  æ ¼å¼åŒ–åé•¿åº¦: 3 å­—ç¬¦
  åŒ…å«å…è´£å£°æ˜: False (é—®å€™ä¸éœ€è¦)

[æµ‹è¯•5] ç´§æ€¥è­¦å‘Šæ·»åŠ 
  åŸå§‹é•¿åº¦: 6 â†’ æ·»åŠ å: 97
  åŒ…å«ç´§æ€¥æ ‡å¿—: True
```

---

## ä»£ç ç»Ÿè®¡

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| `agent/medical_agent.py` | ~1500 | Agentæ ¸å¿ƒï¼ŒåŒ…å«æ‰€æœ‰Skillå®ç° |
| `skills/*/SKILL.md` | ~200 | Skillè§„èŒƒæ–‡æ¡£ |
| `test_independent_skills.py` | ~250 | ç‹¬ç«‹Skillæµ‹è¯• |

---

## ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨ Intent Classifier
```python
from agent.medical_agent import IntentClassifier, DialogueContext

classifier = IntentClassifier()
result = await classifier.classify("æ€ä¹ˆé¢„é˜²é«˜è¡€å‹", DialogueContext("test", "user"))
print(f"æ„å›¾: {result.intent}")        # health_education
print(f"ç½®ä¿¡åº¦: {result.confidence}") # 1.10
print(f"å®ä½“: {result.entities}")    # {'health_topic': 'é«˜è¡€å‹', 'query_type': 'prevention'}
```

### ä½¿ç”¨ Health Educator
```python
from agent.medical_agent import HealthKnowledgeBase

kb = HealthKnowledgeBase()
prevention = kb.get_disease_prevention("é«˜è¡€å‹")
print(prevention['prevention']['diet'])  # ['ä½ç›é¥®é£Ÿ', 'ä½è„‚é¥®é£Ÿ', ...]
```

### ä½¿ç”¨ Response Formatter
```python
from agent.medical_agent import ResponseFormatter

formatter = ResponseFormatter()
response = formatter.format(
    "",
    response_type="symptom",
    symptom="å¤´ç—›",
    data=symptom_data,
    has_risk=True
)
print(response)  # æ ¼å¼åŒ–åçš„å“åº”ï¼ŒåŒ…å«å…è´£å£°æ˜
```

---

## æµ‹è¯•éªŒè¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š

```bash
# å®Œæ•´ç³»ç»Ÿæµ‹è¯•
python run_tests_cn.py

# ç‹¬ç«‹Skillæµ‹è¯•
python test_independent_skills.py
```

---

## æ€»ç»“

ä¸‰ä¸ªä¸è°ƒç”¨MCPçš„Skillç°å·²å®Œå…¨å®ç°ï¼š

1. **Intent Classifier** - åŸºäº+è¯­ä¹‰çš„æ„å›¾åˆ†ç±»ï¼Œæ”¯æŒ8ç§æ„å›¾ç±»å‹
2. **Health Educator** - å†…ç½®å¥åº·çŸ¥è¯†åº“ï¼Œæä¾›ç–¾ç—…é¢„é˜²ã€é¥®é£Ÿç¦å¿Œã€è¿åŠ¨å»ºè®®
3. **Response Formatter** - ç»Ÿä¸€å“åº”æ ¼å¼åŒ–ï¼Œè‡ªåŠ¨æ·»åŠ å…è´£å£°æ˜å’Œç´§æ€¥è­¦å‘Š

æ‰€æœ‰Skillå‡å·²é€šè¿‡åŠŸèƒ½æµ‹è¯•ï¼Œå¯æ­£å¸¸å·¥ä½œã€‚
